#! /bin/zsh

set -e
set -u

DIR="$( cd "$( dirname "$0" )" && pwd )"

if [[ $# < 1 || "$1" != "--force" ]]; then
    print "This command erases existing .vimrc, .tmux.conf, .zshrc files and .vim folder"
    print "Use force parameter to acknowledge you are aware:"
    print "  setup --force"
    exit 1
fi

ln -s -f ~/dotfiles/zshrc ~/.zshrc
ln -s -f ~/dotfiles/vimrc ~/.vimrc
ln -s -f ~/dotfiles/tmux.conf ~/.tmux.conf
if [ -d ~/.vim ]; then
    print "Removing existing directory ~/.vim"
    rm -r ~/.vim
fi
ln -s -f ~/dotfiles/vim ~/.vim

mkdir -p ~/dotfiles/vim/swap
mkdir -p ~/dotfiles/vim/undo
mkdir -p ~/dotfiles/vim/autoload 
mkdir -p ~/dotfiles/vim/bundle

if [ ! -f ~/dotfiles/vim/autoload/pathogen.vim ]; then
    curl -Sso ~/dotfiles/vim/autoload/pathogen.vim \
        https://raw.github.com/tpope/vim-pathogen/master/autoload/pathogen.vim
fi

mkdir -p ~/.dotfiles-local
touch ~/.dotfiles-local/zshrc
touch ~/.dotfiles-local/vimrc
touch ~/.dotfiles-local/tmux.conf

if [ -f ~/.dotfiles-local/setup ]; then
    print "Running ~/.dotfiles-local/setup"
    ~/.dotfiles-local/setup
fi

export GIT_DIR=$DIR/.git
git config --global color.ui true
git config user.name "Grumpy"
git config user.email "grumpy@forloop7.com"
git remote set-url origin https://forloop7@github.com/forloop7/dotfiles.git
git config credential.helper 'cache --timeout=28800' #8h

cd ~/dotfiles/vim
git submodule init
git submodule update
